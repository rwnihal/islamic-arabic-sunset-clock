<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Arabic sunset clock with Hijri calendar, Islamic prayer times, Ramadan fasting tracker, and Quran Khatam calculator.">
  <meta name="keywords" content="Arabic clock, sunset clock, Islamic prayer times, Hijri calendar, Ramadan countdown, Sunnah fasting, Quran Khatam">
  <meta name="author" content="Nihal PS">
  <title>Arabic Sunset Clock â€” Islamic Calendar & Prayer Times</title>
  
  <script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }

    .clock-container {
      background: #ffffff;
      padding: 32px;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      width: 100%;
      max-width: 750px;
    }

    .header {
      text-align: center;
      margin-bottom: 24px;
    }

    .header h1 {
      font-size: 24px;
      color: #333;
      margin-bottom: 8px;
    }

    .hijri-date {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 16px;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 24px;
    }

    .hijri-date h2 {
      font-size: 28px;
      margin-bottom: 4px;
    }

    .hijri-date p {
      font-size: 14px;
      opacity: 0.9;
    }

    .ramadan-counter {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 24px;
      text-align: center;
    }

    .ramadan-counter h3 {
      font-size: 18px;
      color: #856404;
      margin-bottom: 8px;
    }

    .ramadan-counter .days {
      font-size: 32px;
      font-weight: 700;
      color: #856404;
    }

    .fasting-tracker {
      background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      display: none;
    }

    .fasting-tracker.active {
      display: block;
    }

    .fasting-tracker h3 {
      text-align: center;
      color: #d63031;
      font-size: 18px;
      margin-bottom: 16px;
    }

    .sun-tracker {
      position: relative;
      height: 120px;
      margin-bottom: 16px;
    }

    .sun-path {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: #dfe6e9;
      border-radius: 3px;
    }

    .sun-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background: linear-gradient(90deg, #fdcb6e, #e17055);
      border-radius: 3px;
      transition: width 0.3s;
    }

    .sun-icon {
      position: absolute;
      bottom: -10px;
      font-size: 32px;
      transition: left 0.3s;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .fasting-times {
      display: flex;
      justify-content: space-between;
      margin-top: 12px;
      font-size: 13px;
      color: #2d3436;
    }

    .fasting-time {
      text-align: center;
    }

    .fasting-time-label {
      font-weight: 600;
      display: block;
      margin-bottom: 4px;
    }

    .fasting-status {
      text-align: center;
      font-size: 14px;
      color: #d63031;
      font-weight: 600;
      margin-top: 12px;
      padding: 8px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 6px;
    }

    .quran-khatam {
      background: linear-gradient(135deg, #a8e6cf, #81c784);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
    }

    .quran-khatam h3 {
      text-align: center;
      color: #1b5e20;
      font-size: 18px;
      margin-bottom: 16px;
    }

    .khatam-selector {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .khatam-btn {
      padding: 10px 20px;
      border: 2px solid #2e7d32;
      background: white;
      color: #2e7d32;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .khatam-btn.active {
      background: #2e7d32;
      color: white;
    }

    .khatam-btn:hover {
      transform: translateY(-2px);
    }

    .khatam-plan {
      background: white;
      padding: 16px;
      border-radius: 8px;
      margin-top: 12px;
    }

    .khatam-instruction {
      font-size: 14px;
      color: #1b5e20;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .khatam-prayer-times {
      display: grid;
      gap: 8px;
    }

    .khatam-prayer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: #f1f8e9;
      border-radius: 6px;
      font-size: 13px;
    }

    .khatam-prayer-name {
      font-weight: 600;
      color: #33691e;
    }

    .khatam-pages {
      color: #558b2f;
      font-weight: 600;
    }

    .sunset-clock {
      text-align: center;
      margin-bottom: 24px;
    }

    .time-display {
      font-size: 56px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 8px;
      font-variant-numeric: tabular-nums;
    }

    .clock-meta {
      font-size: 13px;
      color: #666;
      margin-bottom: 16px;
      line-height: 1.5;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    select, button {
      padding: 10px 16px;
      border-radius: 8px;
      border: 1px solid #ddd;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    select {
      background: white;
    }

    button {
      background: #667eea;
      color: white;
      border: none;
      font-weight: 500;
    }

    button:hover {
      background: #5568d3;
      transform: translateY(-1px);
    }

    .divider {
      height: 2px;
      background: linear-gradient(90deg, transparent, #e0e0e0, transparent);
      margin: 24px 0;
    }

    .prayer-times {
      margin-bottom: 24px;
    }

    .prayer-times h3 {
      font-size: 20px;
      margin-bottom: 12px;
      color: #333;
      text-align: center;
    }

    .next-prayer {
      font-size: 14px;
      color: #667eea;
      font-weight: 600;
      margin-bottom: 16px;
      text-align: center;
      padding: 8px;
      background: #f0f4ff;
      border-radius: 6px;
    }

    .prayers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .prayer-item {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 12px;
      transition: transform 0.2s;
    }

    .prayer-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .prayer-name {
      font-size: 13px;
      font-weight: 600;
      color: #555;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-align: center;
    }

    .prayer-time-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .prayer-time-label {
      font-size: 10px;
      color: #888;
      text-transform: uppercase;
    }

    .prayer-time {
      font-size: 14px;
      color: #667eea;
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }

    .prayer-source {
      font-size: 11px;
      color: #999;
      margin-top: 12px;
      text-align: center;
    }

    .sunnah-fasting {
      background: #e7f3ff;
      border-left: 4px solid #2196f3;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 24px;
    }

    .sunnah-fasting h3 {
      font-size: 18px;
      color: #0d47a1;
      margin-bottom: 12px;
    }

    .fasting-list {
      display: grid;
      gap: 8px;
    }

    .fasting-item {
      display: flex;
      align-items: center;
      font-size: 14px;
      color: #333;
      padding: 8px;
      background: white;
      border-radius: 6px;
    }

    .fasting-item.today {
      background: #fff9c4;
      font-weight: 600;
      border-left: 3px solid #fbc02d;
    }

    .fasting-icon {
      margin-right: 8px;
      font-size: 18px;
    }

    .hadith-section {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      padding: 20px;
      border-radius: 12px;
      border-left: 4px solid #667eea;
      margin-bottom: 24px;
    }

    .hadith-arabic {
      font-size: 18px;
      line-height: 2;
      color: #2c3e50;
      margin-bottom: 12px;
      direction: rtl;
      text-align: right;
      font-family: 'Traditional Arabic', 'Scheherazade', Arial, sans-serif;
    }

    .hadith-translation {
      font-size: 14px;
      color: #555;
      font-style: italic;
      margin-bottom: 8px;
      line-height: 1.6;
    }

    .hadith-reference {
      font-size: 12px;
      color: #667eea;
      font-weight: 600;
    }

    .quran-verse {
      padding: 20px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 12px;
      border-left: 4px solid #667eea;
    }

    .verse-arabic {
      font-size: 22px;
      line-height: 2;
      color: #2c3e50;
      margin-bottom: 12px;
      direction: rtl;
      text-align: center;
      font-family: 'Traditional Arabic', 'Scheherazade', Arial, sans-serif;
    }

    .verse-translation {
      font-size: 14px;
      color: #555;
      font-style: italic;
      margin-bottom: 8px;
      text-align: center;
      line-height: 1.6;
    }

    .verse-reference {
      font-size: 12px;
      color: #667eea;
      font-weight: 600;
      text-align: center;
    }

    footer {
      text-align: center;
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid #e0e0e0;
    }

    footer p {
      font-size: 12px;
      color: #999;
    }

    footer a {
      color: #667eea;
      text-decoration: none;
      font-weight: 500;
    }

    footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      .time-display {
        font-size: 42px;
      }

      .prayers-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .hijri-date h2 {
        font-size: 22px;
      }

      .clock-container {
        padding: 24px;
      }

      .khatam-btn {
        padding: 8px 16px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div class="clock-container">
    <div class="header">
      <h1>ğŸŒ™ Arabic Sunset Clock</h1>
    </div>

    <div class="hijri-date">
      <h2 id="hijriDate">Loading Hijri Date...</h2>
      <p id="gregorianDate"></p>
    </div>

    <div class="ramadan-counter" id="ramadanCounter">
      <h3>ğŸŒ™ Ramadan Countdown</h3>
      <div class="days" id="ramadanDays">--</div>
      <p id="ramadanText">days remaining</p>
    </div>

    <div class="fasting-tracker" id="fastingTracker">
      <h3>â˜€ï¸ Today's Fasting Progress</h3>
      <div class="sun-tracker">
        <div class="sun-path"></div>
        <div class="sun-progress" id="sunProgress"></div>
        <div class="sun-icon" id="sunIcon">â˜€ï¸</div>
      </div>
      <div class="fasting-times">
        <div class="fasting-time">
          <span class="fasting-time-label">Fajr (Start)</span>
          <span id="fastingStart">--:--</span>
        </div>
        <div class="fasting-time">
          <span class="fasting-time-label">Maghrib (End)</span>
          <span id="fastingEnd">--:--</span>
        </div>
      </div>
      <div class="fasting-status" id="fastingStatus">Calculating...</div>
    </div>

    <div class="quran-khatam">
      <h3>ğŸ“– Quran Khatam Calculator</h3>
      <div class="khatam-selector">
        <button class="khatam-btn active" onclick="selectKhatam(1)">1x Complete</button>
        <button class="khatam-btn" onclick="selectKhatam(2)">2x Complete</button>
        <button class="khatam-btn" onclick="selectKhatam(3)">3x Complete</button>
      </div>
      <div class="khatam-plan" id="khatamPlan">
        <div class="khatam-instruction">Read <strong>4 pages</strong> after each prayer to complete Quran once in Ramadan (30 days)</div>
        <div class="khatam-prayer-times">
          <div class="khatam-prayer">
            <span class="khatam-prayer-name">After Fajr</span>
            <span class="khatam-pages">4 pages</span>
          </div>
          <div class="khatam-prayer">
            <span class="khatam-prayer-name">After Dhuhr</span>
            <span class="khatam-pages">4 pages</span>
          </div>
          <div class="khatam-prayer">
            <span class="khatam-prayer-name">After Asr</span>
            <span class="khatam-pages">4 pages</span>
          </div>
          <div class="khatam-prayer">
            <span class="khatam-prayer-name">After Maghrib</span>
            <span class="khatam-pages">4 pages</span>
          </div>
          <div class="khatam-prayer">
            <span class="khatam-prayer-name">After Isha</span>
            <span class="khatam-pages">4 pages</span>
          </div>
        </div>
      </div>
    </div>

    <div class="sunset-clock">
      <div class="time-display" id="time">--:--</div>
      <div class="clock-meta" id="meta">Calculating sunset time...</div>
      <div class="controls">
        <select id="format" aria-label="Time format">
          <option value="24">24-Hour Format</option>
          <option value="12">12-Hour (AM/PM)</option>
        </select>
        <button onclick="updateAll()" aria-label="Refresh data">ğŸ”„ Refresh</button>
      </div>
    </div>

    <div class="divider"></div>

    <div class="prayer-times">
      <h3>ğŸ•Œ Islamic Prayer Times</h3>
      <div class="next-prayer" id="nextPrayer">Loading prayer times...</div>
      <div class="prayers-grid" id="prayersGrid"></div>
      <div class="prayer-source">Based on: Umm al-Qura, Makkah calculation method</div>
    </div>

    <div class="divider"></div>

    <div class="sunnah-fasting">
      <h3>ğŸŒŸ Sunnah Fasting Days</h3>
      <div class="fasting-list" id="fastingList"></div>
    </div>

    <div class="hadith-section">
      <div class="hadith-arabic">Ø­ÙØ¯ÙÙ‘Ø«ÙÙ†ÙÙŠ Ø¹ÙØ¨Ù’Ø¯Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø¨Ù’Ù†Ù Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯ÙØŒ Ø­ÙØ¯ÙÙ‘Ø«ÙÙ†ÙØ§ Ù‡ÙØ´ÙØ§Ù…ÙŒØŒ Ø£ÙØ®Ù’Ø¨ÙØ±ÙÙ†ÙØ§ Ù…ÙØ¹Ù’Ù…ÙØ±ÙŒØŒ Ø¹ÙÙ†Ù Ø§Ù„Ø²ÙÙ‘Ù‡Ù’Ø±ÙÙŠÙÙ‘ØŒ Ø¹ÙÙ†Ù Ø§Ø¨Ù’Ù†Ù Ø§Ù„Ù’Ù…ÙØ³ÙÙŠÙÙ‘Ø¨ÙØŒ Ø¹ÙÙ†Ù’ Ø£ÙØ¨ÙÙŠ Ù‡ÙØ±ÙÙŠÙ’Ø±ÙØ©Ù Ù€ Ø±Ø¶Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡ Ù€ Ø¹ÙÙ†Ù Ø§Ù„Ù†ÙÙ‘Ø¨ÙÙŠÙÙ‘ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù… Ù‚ÙØ§Ù„Ù â€ "â€ ÙƒÙÙ„ÙÙ‘ Ø¹ÙÙ…ÙÙ„Ù Ø§Ø¨Ù’Ù†Ù Ø¢Ø¯ÙÙ…Ù Ù„ÙÙ‡ÙØŒ Ø¥ÙÙ„Ø§ÙÙ‘ Ø§Ù„ØµÙÙ‘ÙˆÙ’Ù…Ù ÙÙØ¥ÙÙ†ÙÙ‘Ù‡Ù Ù„ÙÙŠØŒ ÙˆÙØ£ÙÙ†ÙØ§ Ø£ÙØ¬Ù’Ø²ÙÙŠ Ø¨ÙÙ‡ÙØŒ ÙˆÙÙ„ÙØ®ÙÙ„ÙÙˆÙÙ ÙÙÙ…Ù Ø§Ù„ØµÙÙ‘Ø§Ø¦ÙÙ…Ù Ø£ÙØ·Ù’ÙŠÙØ¨Ù Ø¹ÙÙ†Ù’Ø¯Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù…ÙÙ†Ù’ Ø±ÙÙŠØ­Ù Ø§Ù„Ù’Ù…ÙØ³Ù’ÙƒÙ â€"â€â€.â€</div>
      <div class="hadith-translation">Narrated Abu Huraira: The Prophet (ï·º) said, "(Allah said), 'Every good deed of Adam's son is for him except fasting; it is for Me. and I shall reward (the fasting person) for it.' Verily, the smell of the mouth of a fasting person is better to Allah than the smell of musk."</div>
      <div class="hadith-reference">Sahih al-Bukhari 5927</div>
    </div>

    <div class="quran-verse">
      <div class="verse-arabic" id="verseArabic">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
      <div class="verse-translation" id="verseTranslation">Loading daily verse...</div>
      <div class="verse-reference" id="verseReference"></div>
    </div>

    <footer>
      <p>Created by <a href="https://nihalps.in" target="_blank">Nihal PS</a></p>
      <p style="margin-top: 8px; font-size: 11px;">Prayer times via <a href="https://aladhan.com" target="_blank">Aladhan API</a></p>
    </footer>
  </div>

  <script>
    let clockFormat = "24";
    let currentLocation = { lat: null, lon: null };
    let currentTimings = null;
    let currentHijriMonth = null;
    let selectedKhatam = 1;
    
    const formatSelect = document.getElementById("format");
    formatSelect.value = clockFormat;
    formatSelect.addEventListener("change", () => {
      clockFormat = formatSelect.value;
      updateSunsetClock();
      if (currentTimings) displayPrayerTimes(currentTimings);
    });

    const quranVerses = [
      {
        arabic: "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù",
        translation: "In the name of Allah, the Most Gracious, the Most Merciful",
        reference: "Surah Al-Fatiha (1:1)"
      },
      {
        arabic: "ÙˆÙÙ…ÙØ§ Ø®ÙÙ„ÙÙ‚Ù’ØªÙ Ø§Ù„Ù’Ø¬ÙÙ†ÙÙ‘ ÙˆÙØ§Ù„Ù’Ø¥ÙÙ†Ø³Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ù„ÙÙŠÙØ¹Ù’Ø¨ÙØ¯ÙÙˆÙ†Ù",
        translation: "And I did not create the jinn and mankind except to worship Me",
        reference: "Surah Adh-Dhariyat (51:56)"
      },
      {
        arabic: "ÙÙØ§Ø°Ù’ÙƒÙØ±ÙÙˆÙ†ÙÙŠ Ø£ÙØ°Ù’ÙƒÙØ±Ù’ÙƒÙÙ…Ù’ ÙˆÙØ§Ø´Ù’ÙƒÙØ±ÙÙˆØ§ Ù„ÙÙŠ ÙˆÙÙ„ÙØ§ ØªÙÙƒÙ’ÙÙØ±ÙÙˆÙ†Ù",
        translation: "So remember Me; I will remember you. And be grateful to Me and do not deny Me",
        reference: "Surah Al-Baqarah (2:152)"
      }
    ];

    function selectKhatam(times) {
      selectedKhatam = times;
      document.querySelectorAll('.khatam-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      updateKhatamPlan(times);
    }

    function updateKhatamPlan(times) {
      const totalPages = 604;
      const days = 30;
      const prayers = 5;
      const pagesPerPrayer = Math.ceil((totalPages * times) / (days * prayers));
      
      const instruction = times === 1 
        ? `Read <strong>${pagesPerPrayer} pages</strong> after each prayer to complete Quran once in Ramadan (30 days)`
        : `Read <strong>${pagesPerPrayer} pages</strong> after each prayer to complete Quran ${times}x in Ramadan (30 days)`;
      
      document.querySelector('.khatam-instruction').innerHTML = instruction;
      document.querySelectorAll('.khatam-pages').forEach(el => {
        el.textContent = `${pagesPerPrayer} pages`;
      });
    }

    function updateFastingTracker(timings) {
      if (!timings) return;
      
      const now = new Date();
      const fajrTime = timings.Fajr.split(':');
      const maghribTime = timings.Maghrib.split(':');
      
      const fajr = new Date(now);
      fajr.setHours(parseInt(fajrTime[0]), parseInt(fajrTime[1]), 0);
      
      const maghrib = new Date(now);
      maghrib.setHours(parseInt(maghribTime[0]), parseInt(maghribTime[1]), 0);
      
      document.getElementById('fastingStart').textContent = timings.Fajr;
      document.getElementById('fastingEnd').textContent = timings.Maghrib;
      
      if (currentHijriMonth === 9) {
        document.getElementById('fastingTracker').classList.add('active');
        
        if (now >= fajr && now <= maghrib) {
          const totalFastingTime = maghrib - fajr;
          const elapsedTime = now - fajr;
          const progress = (elapsedTime / totalFastingTime) * 100;
          
          document.getElementById('sunProgress').style.width = progress + '%';
          document.getElementById('sunIcon').style.left = `calc(${progress}% - 16px)`;
          
          const remainingMs = maghrib - now;
          const remainingHours = Math.floor(remainingMs / (1000 * 60 * 60));
          const remainingMins = Math.floor((remainingMs % (1000 * 60 * 60)) / (1000 * 60));
          
          document.getElementById('fastingStatus').textContent = 
            `â° Iftar in ${remainingHours}h ${remainingMins}m`;
        } else if (now < fajr) {
          document.getElementById('sunProgress').style.width = '0%';
          document.getElementById('sunIcon').style.left = '-16px';
          document.getElementById('fastingStatus').textContent = 'ğŸŒ™ Fasting starts at Fajr';
        } else {
          document.getElementById('sunProgress').style.width = '100%';
          document.getElementById('sunIcon').style.left = 'calc(100% - 16px)';
          document.getElementById('fastingStatus').textContent = 'ğŸ‰ Fasting complete for today!';
        }
      }
    }

    function getDayOfYear(date) {
      const start = new Date(date.getFullYear(), 0, 0);
      const diff = date - start;
      const oneDay = 1000 * 60 * 60 * 24;
      return Math.floor(diff / oneDay);
    }

    function displayDailyVerse() {
      const dayOfYear = getDayOfYear(new Date());
      const verse = quranVerses[dayOfYear % quranVerses.length];
      
      document.getElementById("verseArabic").textContent = verse.arabic;
      document.getElementById("verseTranslation").textContent = verse.translation;
      document.getElementById("verseReference").textContent = verse.reference;
    }

    function getSunset(date, lat, lon) {
      return SunCalc.getTimes(date, lat, lon).sunset;
    }

    function formatTime(hours, minutes, format) {
      if (format === "12") {
        const period = hours >= 12 ? "PM" : "AM";
        hours = hours % 12 || 12;
        return `${hours}:${minutes.toString().padStart(2, "0")} ${period}`;
      }
      return `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}`;
    }

    function convertToSunsetTime(localTime, sunsetHour, sunsetMinute) {
      const [h, m] = localTime.split(':').map(Number);
      const localMinutes = h * 60 + m;
      const sunsetMinutes = sunsetHour * 60 + sunsetMinute;
      
      let diff = localMinutes - sunsetMinutes;
      if (diff < 0) diff += 1440;
      
      const sunsetHours = Math.floor(diff / 60) % 24;
      const sunsetMins = diff % 60;
      
      return formatTime(sunsetHours, sunsetMins, clockFormat);
    }

    async function getHijriDate(lat, lon) {
      const today = new Date();
      const dateStr = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
      const url = `https://api.aladhan.com/v1/timings/${dateStr}?latitude=${lat}&longitude=${lon}&method=4`;
      
      try {
        const response = await fetch(url);
        const data = await response.json();
        return data.data.date.hijri;
      } catch (error) {
        console.error("Error fetching Hijri date:", error);
        return null;
      }
    }

    function displayHijriDate(hijriData) {
      if (!hijriData) return;
      
      const hijriStr = `${hijriData.day} ${hijriData.month.en} ${hijriData.year} AH`;
      document.getElementById("hijriDate").textContent = hijriStr;
      
      const today = new Date();
      const gregorianStr = today.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      document.getElementById("gregorianDate").textContent = gregorianStr;
    }

    function calculateRamadanCountdown(currentHijriMonth, currentHijriDay) {
      const currentMonth = parseInt(currentHijriMonth);
      const currentDay = parseInt(currentHijriDay);
      
      currentHijriMonth = currentMonth;
      
      let daysUntilRamadan;
      
      if (currentMonth < 9) {
        const daysInCurrentMonth = 30;
        const daysLeftInMonth = daysInCurrentMonth - currentDay;
        let monthsBetween = 8 - currentMonth;
        daysUntilRamadan = daysLeftInMonth + (monthsBetween * 30);
      } else if (currentMonth === 9) {
        document.getElementById("ramadanCounter").innerHTML = `
          <h3>ğŸŒ™ Ramadan Mubarak</h3>
          <p style="font-size: 18px; color: #856404; margin-top: 8px;">Day ${currentDay} of 30 - May Allah accept your fasting</p>
        `;
        return;
      } else {
        const daysInCurrentMonth = 30;
        const daysLeftInMonth = daysInCurrentMonth - currentDay;
        let monthsUntilNext = 12 - currentMonth + 8;
        daysUntilRamadan = daysLeftInMonth + (monthsUntilNext * 30);
      }
      
      document.getElementById("ramadanDays").textContent = daysUntilRamadan;
      document.getElementById("ramadanText").textContent = daysUntilRamadan === 1 ? "day remaining" : "days remaining";
    }

    function displaySunnahFastingDays(hijriData) {
      const hijriDay = parseInt(hijriData.day);
      const today = new Date();
      const dayOfWeek = today.getDay();
      
      const fastingDays = [];
      
      if (dayOfWeek === 1) fastingDays.push({ text: "Today is Monday - Sunnah fasting day", isToday: true });
      else fastingDays.push({ text: "Monday - Sunnah fasting day", isToday: false });
      
      if (dayOfWeek === 4) fastingDays.push({ text: "Today is Thursday - Sunnah fasting day", isToday: true });
      else fastingDays.push({ text: "Thursday - Sunnah fasting day", isToday: false });
      
      if (hijriDay === 13) fastingDays.push({ text: "Today is 13th (Ayyam al-Bid) - White Days", isToday: true });
      else fastingDays.push({ text: "13th of Hijri month (Ayyam al-Bid)", isToday: false });
      
      if (hijriDay === 14) fastingDays.push({ text: "Today is 14th (Ayyam al-Bid) - White Days", isToday: true });
      else fastingDays.push({ text: "14th of Hijri month (Ayyam al-Bid)", isToday: false });
      
      if (hijriDay === 15) fastingDays.push({ text: "Today is 15th (Ayyam al-Bid) - White Days", isToday: true });
      else fastingDays.push({ text: "15th of Hijri month (Ayyam al-Bid)", isToday: false });
      
      const listHTML = fastingDays.map(day => `
        <div class="fasting-item ${day.isToday ? 'today' : ''}">
          <span class="fasting-icon">${day.isToday ? 'ğŸŒ™' : 'ğŸ“…'}</span>
          ${day.text}
        </div>
      `).join('');
      
      document.getElementById("fastingList").innerHTML = listHTML;
    }

    async function getPrayerTimes(lat, lon) {
      const today = new Date();
      const dateStr = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
      const url = `https://api.aladhan.com/v1/timings/${dateStr}?latitude=${lat}&longitude=${lon}&method=4`;
      
      try {
        const response = await fetch(url);
        const data = await response.json();
        return data.data;
      } catch (error) {
        console.error("Error fetching prayer times:", error);
        return null;
      }
    }

    function displayPrayerTimes(data) {
      if (!data) return;
      
      const timings = data.timings;
      const now = new Date();
      const sunset = getSunset(now, currentLocation.lat, currentLocation.lon);
      const sunsetHour = sunset.getHours();
      const sunsetMinute = sunset.getMinutes();
      
      const prayers = [
        { name: "Fajr", time: timings.Fajr },
        { name: "Sunrise", time: timings.Sunrise },
        { name: "Dhuhr", time: timings.Dhuhr },
        { name: "Asr", time: timings.Asr },
        { name: "Maghrib", time: timings.Maghrib },
        { name: "Isha", time: timings.Isha }
      ];
      
      const gridHTML = prayers.map(prayer => {
        const sunsetTime = convertToSunsetTime(prayer.time, sunsetHour, sunsetMinute);
        return `
          <div class="prayer-item">
            <div class="prayer-name">${prayer.name}</div>
            <div class="prayer-time-row">
              <span class="prayer-time-label">Local</span>
              <span class="prayer-time">${prayer.time}</span>
            </div>
            <div class="prayer-time-row">
              <span class="prayer-time-label">Sunset</span>
              <span class="prayer-time">${sunsetTime}</span>
            </div>
          </div>
        `;
      }).join('');
      
      document.getElementById("prayersGrid").innerHTML = gridHTML;
      updateNextPrayer(timings);
      updateFastingTracker(timings);
    }

    function updateNextPrayer(timings) {
      const now = new Date();
      const currentMinutes = now.getHours() * 60 + now.getMinutes();
      
      const prayers = [
        { name: "Fajr", time: timings.Fajr },
        { name: "Dhuhr", time: timings.Dhuhr },
        { name: "Asr", time: timings.Asr },
        { name: "Maghrib", time: timings.Maghrib },
        { name: "Isha", time: timings.Isha }
      ];

      for (let prayer of prayers) {
        const [h, m] = prayer.time.split(':').map(Number);
        const prayerMinutes = h * 60 + m;
        
        if (prayerMinutes > currentMinutes) {
          const diff = prayerMinutes - currentMinutes;
          const hours = Math.floor(diff / 60);
          const mins = diff % 60;
          
          let timeStr = "";
          if (hours > 0) timeStr += `${hours} hour${hours > 1 ? 's' : ''} `;
          if (mins > 0) timeStr += `${mins} minute${mins > 1 ? 's' : ''}`;
          
          document.getElementById("nextPrayer").textContent = `Next prayer: ${prayer.name} in ${timeStr.trim()}`;
          return;
        }
      }
      
      document.getElementById("nextPrayer").textContent = "Next prayer: Fajr tomorrow";
    }

    function updateSunsetClock() {
      if (!currentLocation.lat) return;
      
      const now = new Date();
      const sunsetToday = getSunset(now, currentLocation.lat, currentLocation.lon);
      let refSunset = sunsetToday;
      
      if (now < sunsetToday) {
        const yesterday = new Date(now.getTime() - 86400000);
        refSunset = getSunset(yesterday, currentLocation.lat, currentLocation.lon);
      }

      const diffMs = now - refSunset;
      const diffMinutes = Math.floor(diffMs / 60000);
      const hours = Math.floor(diffMinutes / 60) % 24;
      const minutes = diffMinutes % 60;

      document.getElementById("time").textContent = formatTime(hours, minutes, clockFormat);
      document.getElementById("meta").textContent = `Sunset reference: ${refSunset.toLocaleTimeString()} | Current: ${now.toLocaleTimeString()}`;
    }

    async function updateAll() {
      displayDailyVerse();
      updateKhatamPlan(selectedKhatam);
      
      navigator.geolocation.getCurrentPosition(
        async pos => {
          currentLocation.lat = pos.coords.latitude;
          currentLocation.lon = pos.coords.longitude;
          
          updateSunsetClock();
          
          const data = await getPrayerTimes(currentLocation.lat, currentLocation.lon);
          
          if (data) {
            currentTimings = data.timings;
            displayHijriDate(data.date.hijri);
            calculateRamadanCountdown(data.date.hijri.month.number, data.date.hijri.day);
            displaySunnahFastingDays(data.date.hijri);
            displayPrayerTimes(data);
          }
        },
        error => {
          console.error("Geolocation error:", error);
          document.getElementById("meta").textContent = "Please enable location access";
          document.getElementById("nextPrayer").textContent = "Location access required";
        }
      );
    }

    updateAll();
    setInterval(() => {
      updateSunsetClock();
      if (currentTimings) {
        updateNextPrayer(currentTimings);
        updateFastingTracker(currentTimings);
      }
    }, 60000);
  </script>
</body>
</html>
